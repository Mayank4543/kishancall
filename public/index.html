<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semantic Search CSV Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-search"></i> Semantic Search CSV Manager
            </span>
            <div id="connection-status">
                <span class="status-indicator status-ready"></span>
                <span class="text-white">Connected</span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="main-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard"
                    type="button" role="tab">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="api-docs-tab" data-bs-toggle="tab" data-bs-target="#api-docs" type="button"
                    role="tab">
                    <i class="fas fa-code"></i> API Documentation
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="main-tab-content">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">

                <!-- System Status Row -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h5 class="card-title"><i class="fas fa-database"></i></h5>
                                <h3 id="total-docs">0</h3>
                                <p class="card-text">Total Documents</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h5 class="card-title"><i class="fas fa-brain"></i></h5>
                                <h3 id="docs-with-embeddings">0</h3>
                                <p class="card-text">With Embeddings</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h5 class="card-title"><i class="fas fa-percentage"></i></h5>
                                <h3 id="embedding-progress">0%</h3>
                                <p class="card-text">Progress</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h5 class="card-title"><i class="fas fa-clock"></i></h5>
                                <h3 id="last-search-time">-</h3>
                                <p class="card-text">Last Search (ms)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Left Column: CSV Upload & Embedding Generation -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-upload"></i> CSV Upload & Processing</h5>
                            </div>
                            <div class="card-body">
                                <!-- File Upload Area -->
                                <div class="file-upload-area" id="file-upload-area">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                    <h5>Drop CSV file here or click to browse</h5>
                                    <p class="text-muted">Supports CSV files with agricultural data</p>
                                    <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
                                </div>

                                <!-- File Info -->
                                <div id="file-info" style="display: none;" class="mt-3">
                                    <div class="alert alert-info">
                                        <strong>File Selected:</strong> <span id="file-name"></span><br>
                                        <strong>Size:</strong> <span id="file-size"></span>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="d-grid gap-2 mt-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="process-background" checked>
                                        <label class="form-check-label" for="process-background">
                                            Process in background
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="clear-existing">
                                        <label class="form-check-label" for="clear-existing">
                                            Clear existing documents
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="generate-embeddings" checked>
                                        <label class="form-check-label" for="generate-embeddings">
                                            Auto-generate embeddings
                                        </label>
                                    </div>
                                    <button class="btn btn-primary" id="upload-csv-btn" disabled>
                                        <i class="fas fa-upload"></i> Upload & Import CSV
                                    </button>
                                    <button class="btn btn-success" id="generate-embeddings-btn">
                                        <i class="fas fa-brain"></i> Generate Embeddings (Legacy)
                                    </button>
                                    <button class="btn btn-info" id="refresh-status-btn">
                                        <i class="fas fa-sync"></i> Refresh Status
                                    </button>
                                </div>

                                <!-- CSV Queue Manager -->
                                <div class="card mt-3">
                                    <div class="card-header">
                                        <h6><i class="fas fa-list"></i> CSV Processing Queue</h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- Queue Status -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <small><strong>Queue Status:</strong></small>
                                                <div class="badge bg-secondary" id="csv-queue-status">Idle</div>
                                            </div>
                                            <div class="col-md-6">
                                                <small><strong>Queue Length:</strong></small>
                                                <span id="csv-queue-length">0</span> files
                                            </div>
                                        </div>

                                        <!-- Queue Controls -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-success btn-sm" id="csv-queue-start-btn">
                                                        <i class="fas fa-play"></i> Start Queue
                                                    </button>
                                                    <button class="btn btn-warning btn-sm" id="csv-queue-stop-btn">
                                                        <i class="fas fa-stop"></i> Stop Queue
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-info btn-sm" id="csv-queue-refresh-btn">
                                                        <i class="fas fa-sync"></i> Refresh Queue
                                                    </button>
                                                    <button class="btn btn-danger btn-sm" id="csv-queue-clear-btn">
                                                        <i class="fas fa-trash"></i> Clear Queue
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Current Task -->
                                        <div id="csv-current-task" style="display: none;" class="mb-3">
                                            <h6>Current Task</h6>
                                            <div class="card card-body">
                                                <div class="row">
                                                    <div class="col-md-8">
                                                        <strong>File:</strong> <span id="csv-current-file">-</span><br>
                                                        <strong>Status:</strong> <span id="csv-current-status">-</span><br>
                                                        <strong>Progress:</strong> <span id="csv-current-progress">0%</span>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <small>Processed: <span id="csv-current-processed">0</span></small><br>
                                                        <small>Inserted: <span id="csv-current-inserted">0</span></small><br>
                                                        <small>Failed: <span id="csv-current-failed">0</span></small>
                                                    </div>
                                                </div>
                                                <div class="progress mt-2" style="height: 10px;">
                                                    <div class="progress-bar" id="csv-current-progress-bar" role="progressbar" style="width: 0%"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Queue List -->
                                        <div id="csv-queue-list">
                                            <h6>Queue (Empty)</h6>
                                            <div class="text-muted text-center p-3">
                                                <i class="fas fa-inbox fa-2x mb-2"></i>
                                                <p>No CSV files in queue</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Background Embedding Controls -->
                                <div class="card mt-3">
                                    <div class="card-header">
                                        <h6><i class="fas fa-cog"></i> Background Embedding Manager</h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- Control Buttons -->
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-info" id="bg-safety-check-btn">
                                                        <i class="fas fa-shield-alt"></i> Safety Check
                                                    </button>
                                                    <button class="btn btn-success" id="bg-start-btn">
                                                        <i class="fas fa-play"></i> Start
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-warning" id="bg-pause-btn" disabled>
                                                        <i class="fas fa-pause"></i> Pause
                                                    </button>
                                                    <button class="btn btn-info" id="bg-resume-btn" disabled>
                                                        <i class="fas fa-play"></i> Resume
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-danger" id="bg-stop-btn" disabled>
                                                        <i class="fas fa-stop"></i> Stop
                                                    </button>
                                                    <button class="btn btn-secondary" id="bg-reset-btn" disabled>
                                                        <i class="fas fa-redo"></i> Reset
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Status Display -->
                                        <div class="mb-3">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <small><strong>Status:</strong></small>
                                                    <div class="badge bg-secondary" id="bg-status">Not Running</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <small><strong>Progress:</strong></small>
                                                    <div id="bg-progress">0%</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Progress Bar -->
                                        <div class="progress mb-3" style="height: 20px;">
                                            <div class="progress-bar progress-bar-striped" id="bg-progress-bar"
                                                role="progressbar" style="width: 0%"></div>
                                        </div>

                                        <!-- Configuration -->
                                        <div class="collapse" id="bg-config">
                                            <div class="card card-body">
                                                <h6>Configuration</h6>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label for="bg-batch-size" class="form-label">Batch Size</label>
                                                        <input type="number" class="form-control form-control-sm"
                                                            id="bg-batch-size" value="50" min="1" max="1000">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="bg-delay" class="form-label">Delay (ms)</label>
                                                        <input type="number" class="form-control form-control-sm"
                                                            id="bg-delay" value="100" min="0" max="5000">
                                                    </div>
                                                </div>
                                                <div class="row mt-2">
                                                    <div class="col-md-6">
                                                        <label for="bg-retry" class="form-label">Retry Attempts</label>
                                                        <input type="number" class="form-control form-control-sm"
                                                            id="bg-retry" value="3" min="0" max="10">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="bg-priority" class="form-label">Priority</label>
                                                        <select class="form-select form-select-sm" id="bg-priority">
                                                            <option value="low">Low</option>
                                                            <option value="normal" selected>Normal</option>
                                                            <option value="high">High</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="mt-2">
                                                    <button class="btn btn-sm btn-primary" id="bg-apply-config">
                                                        <i class="fas fa-check"></i> Apply Configuration
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Toggle Configuration -->
                                        <button class="btn btn-outline-secondary btn-sm" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#bg-config">
                                            <i class="fas fa-cog"></i> Configuration
                                        </button>

                                        <!-- View Logs -->
                                        <button class="btn btn-outline-info btn-sm" id="bg-view-logs">
                                            <i class="fas fa-list"></i> View Logs
                                        </button>

                                        <!-- Status Details -->
                                        <div class="mt-3" id="bg-status-details" style="display: none;">
                                            <h6>Details</h6>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <small>Processed: <span id="bg-processed">0</span></small><br>
                                                    <small>Success: <span id="bg-success">0</span></small><br>
                                                    <small>Failed: <span id="bg-failed">0</span></small>
                                                </div>
                                                <div class="col-md-6">
                                                    <small>Elapsed: <span id="bg-elapsed">0s</span></small><br>
                                                    <small>ETA: <span id="bg-eta">N/A</span></small><br>
                                                    <small>Batch: <span id="bg-batch">0</span></small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Progress Bar -->
                                <div class="progress-container">
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated"
                                            id="progress-bar" role="progressbar" style="width: 0%"></div>
                                    </div>
                                    <div class="text-center mt-2">
                                        <small id="progress-text">Processing...</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Logs -->
                        <div class="card">
                            <div class="card-header d-flex justify-content-between">
                                <h5><i class="fas fa-terminal"></i> System Logs</h5>
                                <button class="btn btn-sm btn-outline-secondary" id="clear-logs-btn">
                                    <i class="fas fa-trash"></i> Clear
                                </button>
                            </div>
                            <div class="card-body p-0">
                                <div class="log-container" id="log-container">
                                    <div class="log-entry log-info">System ready. Upload a CSV file to get started.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Semantic Search -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-search"></i> Semantic Search</h5>
                            </div>
                            <div class="card-body">
                                <!-- Search Input -->
                                <div class="mb-3">
                                    <label for="search-query" class="form-label">Search Query</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="search-query"
                                            placeholder="Enter your search query (e.g., 'Government Schemes', 'crop disease management')">
                                        <button class="btn btn-primary" id="search-btn">
                                            <i class="fas fa-search"></i> Search
                                        </button>
                                    </div>
                                </div>

                                <!-- Search Options -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="search-limit" class="form-label">Results Limit</label>
                                        <select class="form-select" id="search-limit">
                                            <option value="5">5 results</option>
                                            <option value="10" selected>10 results</option>
                                            <option value="20">20 results</option>
                                            <option value="50">50 results</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="search-method" class="form-label">Search Method</label>
                                        <select class="form-select" id="search-method">
                                            <option value="vector">Vector Search (Fast)</option>
                                            <option value="fallback">Fallback Search (Reliable)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Filters -->
                                <div class="mb-3">
                                    <button class="btn btn-outline-secondary btn-sm" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#search-filters">
                                        <i class="fas fa-filter"></i> Advanced Filters
                                    </button>
                                </div>

                                <div class="collapse" id="search-filters">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="filter-state" class="form-label">State</label>
                                            <input type="text" class="form-control" id="filter-state"
                                                placeholder="e.g., Maharashtra">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="filter-category" class="form-label">Category</label>
                                            <input type="text" class="form-control" id="filter-category"
                                                placeholder="e.g., Crop">
                                        </div>
                                    </div>
                                </div>

                                <!-- Quick Search Buttons -->
                                <div class="mb-3">
                                    <h6>Quick Searches:</h6>
                                    <div class="d-flex flex-wrap gap-2">
                                        <button class="btn btn-outline-primary btn-sm quick-search"
                                            data-query="Government Schemes">
                                            Government Schemes
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm quick-search"
                                            data-query="crop disease management">
                                            Crop Disease
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm quick-search"
                                            data-query="fertilizer application">
                                            Fertilizer
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm quick-search"
                                            data-query="pest control">
                                            Pest Control
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm quick-search"
                                            data-query="irrigation techniques">
                                            Irrigation
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Search Results -->
                        <div class="card">
                            <div class="card-header d-flex justify-content-between">
                                <h5><i class="fas fa-list"></i> Search Results</h5>
                                <span id="results-count" class="badge bg-primary">0 results</span>
                            </div>
                            <div class="card-body p-0" style="max-height: 600px; overflow-y: auto;">
                                <div id="search-results">
                                    <div class="text-center text-muted p-4">
                                        <i class="fas fa-search fa-3x mb-3"></i>
                                        <p>Enter a search query to see results</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div> <!-- End Dashboard Tab -->

            <!-- API Documentation Tab -->
            <div class="tab-pane fade" id="api-docs" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-book"></i> API Documentation</h4>
                                <p class="mb-0 text-muted">Complete API reference for the Semantic Search CSV Manager
                                </p>
                            </div>
                            <div class="card-body">

                                <!-- Base URL -->
                                <div class="mb-4">
                                    <h5><i class="fas fa-server"></i> Base URL</h5>
                                    <div class="bg-light p-3 rounded">
                                        <code>http://localhost:8080</code>
                                    </div>
                                </div>

                                <!-- Endpoints -->
                                <div class="accordion" id="api-accordion">

                                    <!-- Health Check -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                                data-bs-target="#health-check">
                                                <span class="badge bg-success me-2">GET</span>
                                                <strong>/ - Health Check</strong>
                                            </button>
                                        </h2>
                                        <div id="health-check" class="accordion-collapse collapse show"
                                            data-bs-parent="#api-accordion">
                                            <div class="accordion-body">
                                                <p>Returns server status and available endpoints.</p>

                                                <h6><i class="fas fa-arrow-up"></i> Request</h6>
                                                <div class="bg-light p-3 rounded mb-3">
                                                    <code>GET /</code>
                                                </div>

                                                <h6><i class="fas fa-arrow-down"></i> Response</h6>
                                                <pre class="bg-dark text-light p-3 rounded"><code>{
  "message": "ðŸš€ Semantic Search CSV Manager is running!",
  "status": "healthy",
  "embeddingsReady": true,
  "endpoints": {
    "uploadCSV": "POST /api/upload-csv",
    "search": "POST /api/search",
    "searchFallback": "POST /api/search-fallback",
    "generateEmbeddings": "POST /api/generate-embeddings",
    "status": "GET /api/status"
  }
}</code></pre>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- System Status -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#system-status">
                                                <span class="badge bg-success me-2">GET</span>
                                                <strong>/api/status - System Status</strong>
                                            </button>
                                        </h2>
                                        <div id="system-status" class="accordion-collapse collapse"
                                            data-bs-parent="#api-accordion">
                                            <div class="accordion-body">
                                                <p>Get detailed system status including database stats and embedding
                                                    progress.</p>

                                                <h6><i class="fas fa-arrow-up"></i> Request</h6>
                                                <div class="bg-light p-3 rounded mb-3">
                                                    <code>GET /api/status</code>
                                                </div>

                                                <h6><i class="fas fa-arrow-down"></i> Response</h6>
                                                <pre class="bg-dark text-light p-3 rounded"><code>{
  "status": "healthy",
  "database": {
    "connected": true,
    "totalDocuments": 50000,
    "documentsWithEmbeddings": 45000,
    "embeddingProgress": "90.0%"
  },
  "embeddingsReady": true,
  "isInitializing": false
}</code></pre>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CSV Upload -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#csv-upload">
                                                <span class="badge bg-warning me-2">POST</span>
                                                <strong>/api/upload-csv - Upload CSV File</strong>
                                            </button>
                                        </h2>
                                        <div id="csv-upload" class="accordion-collapse collapse"
                                            data-bs-parent="#api-accordion">
                                            <div class="accordion-body">
                                                <p>Upload and process a CSV file containing agricultural data.</p>

                                                <h6><i class="fas fa-arrow-up"></i> Request</h6>
                                                <div class="bg-light p-3 rounded mb-3">
                                                    <strong>Method:</strong> <code>POST /api/upload-csv</code><br>
                                                    <strong>Content-Type:</strong> <code>multipart/form-data</code><br>
                                                    <strong>Body:</strong> Form data with file field named
                                                    <code>csvFile</code>
                                                </div>

                                                <h6>Expected CSV Headers</h6>
                                                <div class="table-responsive mb-3">
                                                    <table class="table table-sm table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Column</th>
                                                                <th>Type</th>
                                                                <th>Description</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>StateName</td>
                                                                <td>String</td>
                                                                <td>Name of the state</td>
                                                            </tr>
                                                            <tr>
                                                                <td>DistrictName</td>
                                                                <td>String</td>
                                                                <td>Name of the district</td>
                                                            </tr>
                                                            <tr>
                                                                <td>BlockName</td>
                                                                <td>String</td>
                                                                <td>Name of the block</td>
                                                            </tr>
                                                            <tr>
                                                                <td>Season</td>
                                                                <td>String</td>
                                                                <td>Agricultural season</td>
                                                            </tr>
                                                            <tr>
                                                                <td>Sector</td>
                                                                <td>String</td>
                                                                <td>Agricultural sector</td>
                                                            </tr>
                                                            <tr>
                                                                <td>Category</td>
                                                                <td>String</td>
                                                                <td>Query category</td>
                                                            </tr>
                                                            <tr>
                                                                <td>Crop</td>
                                                                <td>String</td>
                                                                <td>Crop name</td>
                                                            </tr>
                                                            <tr>
                                                                <td>QueryType</td>
                                                                <td>String</td>
                                                                <td>Type of query</td>
                                                            </tr>
                                                            <tr>
                                                                <td>QueryText</td>
                                                                <td>String</td>
                                                                <td>The actual query text</td>
                                                            </tr>
                                                            <tr>
                                                                <td>KccAns</td>
                                                                <td>String</td>
                                                                <td>Answer/response text</td>
                                                            </tr>
                                                            <tr>
                                                                <td>CreatedOn</td>
                                                                <td>Date</td>
                                                                <td>Creation date</td>
                                                            </tr>
                                                            <tr>
                                                                <td>year</td>
                                                                <td>Number</td>
                                                                <td>Year</td>
                                                            </tr>
                                                            <tr>
                                                                <td>month</td>
                                                                <td>Number</td>
                                                                <td>Month</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>

                                                <h6><i class="fas fa-arrow-down"></i> Success Response</h6>
                                                <pre class="bg-dark text-light p-3 rounded"><code>{
  "success": true,
  "message": "CSV uploaded and processed successfully",
  "totalProcessed": 49999,
  "totalInserted": 49999
}</code></pre>

                                                <h6><i class="fas fa-exclamation-triangle"></i> Error Response</h6>
                                                <pre class="bg-dark text-light p-3 rounded"><code>{
  "error": "CSV upload failed",
  "message": "No file uploaded"
}</code></pre>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Semantic Search -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#semantic-search">
                                                <span class="badge bg-warning me-2">POST</span>
                                                <strong>/api/search - Semantic Search (Vector)</strong>
                                            </button>
                                        </h2>
                                        <div id="semantic-search" class="accordion-collapse collapse"
                                            data-bs-parent="#api-accordion">
                                            <div class="accordion-body">
                                                <p>Perform semantic search using MongoDB Atlas vector search for fast
                                                    results.</p>

                                                <h6><i class="fas fa-arrow-up"></i> Request</h6>
                                                <div class="bg-light p-3 rounded mb-3">
                                                    <strong>Method:</strong> <code>POST /api/search</code><br>
                                                    <strong>Content-Type:</strong> <code>application/json</code>
                                                </div>

                                                <h6>Request Body Schema</h6>
                                                <pre class="bg-dark text-light p-3 rounded mb-3"><code>{
  "query": "string (required)",     // Search query text
  "topK": "number (optional)",      // Number of results (default: 10)
  "filters": {                      // Optional filters
    "StateName": "string",
    "DistrictName": "string",
    "Category": "string",
    "Season": "string",
    "Crop": "string"
  }
}</code></pre>

                                                <h6>Example Request</h6>
                                                <pre class="bg-dark text-light p-3 rounded mb-3"><code>{
  "query": "Government schemes for farmers",
  "topK": 5,
  "filters": {
    "StateName": "Maharashtra",
    "Category": "Government Schemes"
  }
}</code></pre>

                                                <h6><i class="fas fa-arrow-down"></i> Success Response</h6>
                                                <pre class="bg-dark text-light p-3 rounded"><code>{
  "success": true,
  "query": "Government schemes for farmers",
  "topK": 5,
  "filters": { "StateName": "Maharashtra" },
  "resultsCount": 5,
  "searchTime": "45ms",
  "results": [
    {
      "id": "64f1a2b3c4d5e6f7g8h9i0j1",
      "similarity": 0.8945,
      "StateName": "Maharashtra",
      "DistrictName": "Pune",
      "Category": "Government Schemes",
      "QueryType": "Information",
      "QueryText": "What government schemes are available?",
      "KccAns": "PM-KISAN, PMFBY, and other schemes...",
      "Crop": "Rice",
      "Season": "Kharif",
      "CreatedOn": "2024-01-15T10:30:00.000Z"
    }
  ]
}</code></pre>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Fallback Search -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#fallback-search">
                                                <span class="badge bg-warning me-2">POST</span>
                                                <strong>/api/search-fallback - Fallback Search</strong>
                                            </button>
                                        </h2>
                                        <div id="fallback-search" class="accordion-collapse collapse"
                                            data-bs-parent="#api-accordion">
                                            <div class="accordion-body">
                                                <p>Perform semantic search using manual cosine similarity calculation
                                                    for reliable results when vector search is unavailable.</p>

                                                <h6><i class="fas fa-arrow-up"></i> Request</h6>
                                                <div class="bg-light p-3 rounded mb-3">
                                                    <strong>Method:</strong> <code>POST /api/search-fallback</code><br>
                                                    <strong>Content-Type:</strong> <code>application/json</code><br>
                                                    <strong>Body:</strong> Same as <code>/api/search</code>
                                                </div>

                                                <h6><i class="fas fa-arrow-down"></i> Response</h6>
                                                <p>Same format as <code>/api/search</code> but may take longer to
                                                    process.</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Generate Embeddings -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#generate-embeddings">
                                                <span class="badge bg-warning me-2">POST</span>
                                                <strong>/api/generate-embeddings - Generate Embeddings</strong>
                                            </button>
                                        </h2>
                                        <div id="generate-embeddings" class="accordion-collapse collapse"
                                            data-bs-parent="#api-accordion">
                                            <div class="accordion-body">
                                                <p>Start the asynchronous process of generating embeddings for all
                                                    documents in the database.</p>

                                                <h6><i class="fas fa-arrow-up"></i> Request</h6>
                                                <div class="bg-light p-3 rounded mb-3">
                                                    <strong>Method:</strong>
                                                    <code>POST /api/generate-embeddings</code><br>
                                                    <strong>Content-Type:</strong> <code>application/json</code><br>
                                                    <strong>Body:</strong> Empty or <code>{}</code>
                                                </div>

                                                <h6><i class="fas fa-arrow-down"></i> Response</h6>
                                                <pre class="bg-dark text-light p-3 rounded"><code>{
  "success": true,
  "message": "Embedding generation started. Check /api/status for progress.",
  "note": "This is an asynchronous process that may take several minutes."
}</code></pre>

                                                <div class="alert alert-info">
                                                    <i class="fas fa-info-circle"></i>
                                                    <strong>Note:</strong> This process runs in the background. Monitor
                                                    progress using the <code>/api/status</code> endpoint.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Error Codes -->
                                <div class="mt-4">
                                    <h5><i class="fas fa-exclamation-triangle"></i> Common Error Codes</h5>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Status Code</th>
                                                    <th>Error Type</th>
                                                    <th>Description</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><span class="badge bg-warning">400</span></td>
                                                    <td>Bad Request</td>
                                                    <td>Missing required parameters or invalid request format</td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-warning">404</span></td>
                                                    <td>Not Found</td>
                                                    <td>Endpoint does not exist</td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-danger">500</span></td>
                                                    <td>Internal Server Error</td>
                                                    <td>Server error during processing</td>
                                                </tr>
                                                <tr>
                                                    <td><span class="badge bg-danger">503</span></td>
                                                    <td>Service Unavailable</td>
                                                    <td>Semantic search module not available</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Rate Limits -->
                                <div class="mt-4">
                                    <h5><i class="fas fa-clock"></i> Rate Limits & Performance</h5>
                                    <div class="alert alert-info">
                                        <ul class="mb-0">
                                            <li><strong>CSV Upload:</strong> Max file size 50MB</li>
                                            <li><strong>Search Requests:</strong> No rate limit (local server)</li>
                                            <li><strong>Vector Search:</strong> ~50-200ms response time</li>
                                            <li><strong>Fallback Search:</strong> ~500-2000ms response time</li>
                                            <li><strong>Embedding Generation:</strong> ~1-5 minutes for 50k documents
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <!-- Examples -->
                                <div class="mt-4">
                                    <h5><i class="fas fa-code"></i> cURL Examples</h5>

                                    <h6>Search Request</h6>
                                    <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "crop disease management techniques",
    "topK": 10,
    "filters": {
      "StateName": "Karnataka",
      "Category": "Disease Management"
    }
  }'</code></pre>

                                    <h6>Status Check</h6>
                                    <pre
                                        class="bg-dark text-light p-3 rounded"><code>curl -X GET http://localhost:8080/api/status</code></pre>

                                    <h6>Generate Embeddings</h6>
                                    <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/generate-embeddings \
  -H "Content-Type: application/json" \
  -d '{}'</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Background Logs Modal -->
    <div class="modal fade" id="bg-logs-modal" tabindex="-1" aria-labelledby="bg-logs-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bg-logs-modal-label">
                        <i class="fas fa-terminal"></i> Background Embedding Logs
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Log Controls -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="log-level-filter" class="form-label">Filter by Level</label>
                            <select class="form-select form-select-sm" id="log-level-filter">
                                <option value="">All Levels</option>
                                <option value="info">Info</option>
                                <option value="success">Success</option>
                                <option value="warning">Warning</option>
                                <option value="error">Error</option>
                                <option value="debug">Debug</option>
                                <option value="progress">Progress</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="log-limit" class="form-label">Number of Logs</label>
                            <select class="form-select form-select-sm" id="log-limit">
                                <option value="50">50 entries</option>
                                <option value="100" selected>100 entries</option>
                                <option value="200">200 entries</option>
                                <option value="500">500 entries</option>
                            </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button class="btn btn-sm btn-primary me-2" id="refresh-logs-btn">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                            <button class="btn btn-sm btn-warning me-2" id="clear-bg-logs-btn">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="auto-refresh-logs">
                                <label class="form-check-label" for="auto-refresh-logs">
                                    Auto-refresh
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Logs Container -->
                    <div class="bg-dark text-light p-3 rounded"
                        style="height: 400px; overflow-y: auto; font-family: monospace;">
                        <div id="bg-logs-content">Loading logs...</div>
                    </div>

                    <!-- Log Statistics -->
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <small class="text-muted">
                                <span id="log-stats">Logs will be displayed here...</span>
                            </small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script src="/js/app.js"></script>
</body>

</html>